<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Sistema de Liquidación de Haberes</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial,Helvetica,sans-serif;background:#f6f8fb;margin:0;padding:20px}
h1{text-align:center}
select,input,button{padding:6px;margin:4px}
.box{background:#fff;border-radius:8px;padding:16px;max-width:1200px;margin:auto}
.row{display:flex;gap:12px;flex-wrap:wrap}
.col{flex:1;min-width:200px}
.status{margin:10px 0;color:#555}
</style>
</head>
<body>
<div class="box">
<h1>Sistema de Liquidación de Haberes</h1>

<div class="row">
  <div class="col">
    <label>Rama</label><br>
    <select id="rama"></select>
  </div>
  <div class="col">
    <label>Agrupamiento</label><br>
    <select id="agrup"></select>
  </div>
  <div class="col">
    <label>Categoría</label><br>
    <select id="categoria"></select>
  </div>
  <div class="col">
    <label>Mes</label><br>
    <select id="mes"></select>
  </div>
</div>

<div class="status" id="status">Cargando maestro…</div>

<button onclick="calcularMensual()">Calcular mensual</button>
</div>

<script>
const API = location.origin;

function setStatus(t){document.getElementById("status").innerText=t}

async function fetchJSON(url){
  const r = await fetch(url);
  if(!r.ok) throw new Error(await r.text());
  return r.json();
}

let META=null;

document.addEventListener("DOMContentLoaded", async ()=>{
  try{
    META = await fetchJSON(API+"/meta");
    cargarRamas();
    setStatus("Maestro cargado.");
  }catch(e){
    setStatus("Error cargando maestro");
    console.error(e);
  }
});

function cargarRamas(){
  const s=document.getElementById("rama");
  s.innerHTML="<option value=''>Seleccione</option>";
  META.ramas.forEach(r=>{
    const o=document.createElement("option");
    o.value=r;o.textContent=r;s.appendChild(o);
  });
  s.onchange=()=>{cargarMeses();cargarAgrup();}
}

function cargarMeses(){
  const rama=document.getElementById("rama").value;
  const s=document.getElementById("mes");
  s.innerHTML="<option value=''>Seleccione</option>";
  if(!rama) return;
  META.meses.filter(m=>m>="2026-01").forEach(m=>{
    const o=document.createElement("option");
    o.value=m;o.textContent=m;s.appendChild(o);
  });
}

function cargarAgrup(){
  const rama=document.getElementById("rama").value;
  const s=document.getElementById("agrup");
  s.innerHTML="<option value=''>Seleccione</option>";
  if(!rama) return;
  (META.agrupamientos[rama]||[]).forEach(a=>{
    const o=document.createElement("option");
    o.value=a;o.textContent=a;s.appendChild(o);
  });
  s.onchange=cargarCategorias;
}

function cargarCategorias(){
  const rama=document.getElementById("rama").value;
  const agrup=document.getElementById("agrup").value;
  const s=document.getElementById("categoria");
  s.innerHTML="<option value=''>Seleccione</option>";
  if(!rama||!agrup) return;
  (META.categorias?.[rama]?.[agrup]||[]).forEach(c=>{
    const o=document.createElement("option");
    o.value=c;o.textContent=c;s.appendChild(o);
  });
}

function calcularMensual(){
  const rama=document.getElementById("rama").value;
  const mes=document.getElementById("mes").value;
  if(!rama||!mes){alert("Falta rama o mes");return}
  alert("Cálculo OK (stub). Backend listo para /payload.");
}
</script>
</body>
</html>
