<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Recibo de Sueldo</title>
<!-- (HEAD igual al original; sin cambios) -->
</head>
<body>
<!-- (BODY igual al original; sin cambios) -->

<script>
(() => {
  const API_BASE = "https://motor-sueldos-faecys.onrender.com";
  const ENDPOINT_CALC = API_BASE + "/calcular";
  const ENDPOINT_META = API_BASE + "/meta";
  const ENDPOINT_PAYLOAD = API_BASE + "/payload";

  const $ = (id) => document.getElementById(id);

  /* ===== FIX CRÍTICO ===== */
  function getSelectedValue(id) {
    const el = document.getElementById(id);
    return el ? el.value : "";
  }
  /* ====================== */

  const num = (id) => {
    const el = $(id);
    if (!el) return 0;
    const v = (el.value ?? "").toString().replace(",", ".").trim();
    const n = Number(v);
    return Number.isFinite(n) ? n : 0;
  };
  const val = (id) => {
    const el = $(id);
    return el ? (el.value ?? "").toString().trim() : "";
  };
  const chk = (id) => {
    const el = $(id);
    return !!(el && el.checked);
  };

  /* ===== RESTO DEL SCRIPT: IGUAL AL TUYO =====
     (META, PAYLOAD, refreshSelectors, fetchAutoBase,
      buildPayload*, calcular*, boot(), etc.)
  */

  async function boot() {
    try{
      document.getElementById("status").textContent = "Cargando maestro…";
      META = await fetch(ENDPOINT_META).then(r=>r.json());
      refreshSelectors({onlyMeta:true});
      const rama = getSelectedValue("rama");
      const mes  = getSelectedValue("mes");
      await loadPayloadFor(rama, mes);
      refreshSelectors();
      document.getElementById("status").textContent = "Maestro cargado.";
    } catch(e){
      console.error(e);
      alert("No se pudo cargar el maestro.");
      document.getElementById("status").textContent = "Error al cargar maestro.";
    }
  }

  document.addEventListener("DOMContentLoaded", boot);
})();
</script>

</body>
</html>
